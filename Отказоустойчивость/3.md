# Домашнее задание к занятию 3 «Резервное копирование» - Иванов Дмитрий fops-13


------


### Задание 1
- Составьте команду rsync, которая позволяет создавать зеркальную копию домашней директории пользователя в директорию `/tmp/backup`
- Необходимо исключить из синхронизации все директории, начинающиеся с точки (скрытые)
- Необходимо сделать так, чтобы rsync подсчитывал хэш-суммы для всех файлов, даже если их время модификации и размер идентичны в источнике и приемнике.
- На проверку направить скриншот с командой и результатом ее выполнения


------
### Решение задания 1
 ```
 # Данная команда будет сравнивать хэш-суммы файлов между исходной директорией и директорией назначения, и копировать только те файлы, у которых хэш-суммы отличаются. (инкрементное копирование)

 rsync -acv --delete --exclude '*.*' . /tmp/backup

--archive, -a       archive mode is -rlptgoD (no -A,-X,-U,-N,-H)
--checksum, -c      skip based on checksum, not mod-time & size
--verbose, -v       increase verbosity
--delete            delete extraneous files from dest dirs

Опции:
-a сохраняет все атрибуты файлов, 
-v выводит подробный вывод на экран,
-с если дословно пропускать на основании контрольной суммы, а не времени и размера,
--delete если дословно, удалить посторонние файлы из каталогов назначения.
Если мы удалили какой-то файл из исходной директории, но при этом этот файл ещё остался в качестве бекапа в директории назначения, то данная опция поможет нам сделать зеркальную копию, а именно удалит его (файл) из директории назначения.

 ```
- пример работы rsync (без опции --delete):
![rsync](https://github.com/dmlorren/netology-homework/blob/main/Отказоустойчивость/img/rsync_1.png)
 
- пример работы rsync (c опцией --delete):
![rsync](https://github.com/dmlorren/netology-homework/blob/main/Отказоустойчивость/img/rsync_2.png)


------
### Задание 2
- Написать скрипт и настроить задачу на регулярное резервное копирование домашней директории пользователя с помощью rsync и cron.
- Резервная копия должна быть полностью зеркальной
- Резервная копия должна создаваться раз в день, в системном логе должна появляться запись об успешном или неуспешном выполнении операции
- Резервная копия размещается локально, в директории `/tmp/backup`
- На проверку направить файл crontab и скриншот с результатом работы утилиты.

------
### Решение задания 2

1. Сам bash скрипт имеет вид:
```
root@hostname-debian1:~# cat /scripts/rsync_bash.sh
#!/bin/bash

# Путь к директории, которую нужно скопировать
src_dir="/root/"

# Путь к целевой директории, куда нужно скопировать
dst_dir="/tmp/backup"

# Выполнение копирования с помощью rsync
rsync -a --delete --exclude '*.*' "$src_dir" "$dst_dir"

# Проверка кода возврата rsync через оператор сравнения
if [ $? -eq 0 ]; then
  # Запись успешного выполнения операции в системный журнал
  logger "Бэкап осуществлён успешно!"
else
  # Запись неуспешного выполнения операции в системный журнал
  logger "Бэкап не был осуществлён!"
fi
```

2. Успешный результат выполнения скрипта представлен на скриншоте:

![rsync](https://github.com/dmlorren/netology-homework/blob/main/Отказоустойчивость/img/rsync_3.png)